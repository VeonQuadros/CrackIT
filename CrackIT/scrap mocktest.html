<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mock Test</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <style>
    /* Prevent text selection and tap highlight on interactive elements only */
    .option-btn,
    .nav-button,
    .difficulty-btn,
    .theme-toggle,
    .try-again-btn,
    .question-dot,
    .start-btn,
    .analysis-btn {
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    :root {
      --background: #121212;
      --text-primary: #e0e0e0;
      --text-secondary: #888888;
      --card-bg: #1e1e1e;
      --border: #333333;
      --button-bg: #2a2a2a;
      --primary: #4CAF50;
      --primary-light: rgba(76, 175, 80, 0.2);
      --primary-bg: rgba(76, 175, 80, 0.1);
      --error: #f44336;
      --error-light: rgba(244, 67, 54, 0.2);
      --error-bg: rgba(244, 67, 54, 0.1);
      --warning: #FF9800;
      --warning-light: rgba(255, 152, 0, 0.2);
      --warning-bg: rgba(255, 152, 0, 0.1);
      --info: #2196F3;
      --info-light: rgba(33, 150, 243, 0.1);
      --accent: #21CBF3;
      --shadow: rgba(0, 0, 0, 0.2);
      --gradient: linear-gradient(45deg, #4CAF50, #45D149);
      --correct-green: #4CAF50;
      --try-again: #4CAF50;
    }

    [data-theme="light"] {
      --background: #ffffff;
      --text-primary: #333333;
      --text-secondary: #666666;
      --card-bg: #f5f5f5;
      --border: #e0e0e0;
      --button-bg: #e0e0e0;
      --primary: #0288D1;
      --primary-light: rgba(2, 136, 209, 0.2);
      --primary-bg: rgba(2, 136, 209, 0.05);
      --error: #d32f2f;
      --error-light: rgba(244, 67, 54, 0.1);
      --error-bg: rgba(244, 67, 54, 0.05);
      --warning: #f57c00;
      --warning-light: rgba(255, 152, 0, 0.1);
      --warning-bg: rgba(255, 152, 0, 0.05);
      --info: #1976d2;
      --info-light: rgba(33, 150, 243, 0.1);
      --accent: #40c4ff;
      --shadow: rgba(0, 0, 0, 0.1);
      --gradient: linear-gradient(45deg, #2196F3, #21CBF3);
      --correct-green: #4CAF50;
      --try-again: #0288D1;
    }

    [data-theme="dark"] .answer-content {
      background-color: rgba(30, 30, 30, 0.9);
      color: #e0e0e0;
    }

    [data-theme="dark"] .result[data-status="correct"] .result-content {
      background-color: rgba(76, 175, 80, 0.1);
      color: #e0e0e0;
    }

    [data-theme="dark"] .result[data-status="incorrect"] .result-content {
      background-color: rgba(244, 67, 54, 0.1);
      color: #e0e0e0;
    }

    [data-theme="dark"] .result[data-status="unanswered"] .result-content {
      background-color: rgba(255, 152, 0, 0.1);
      color: #e0e0e0;
    }

    [data-theme="dark"] .instructions-section {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    [data-theme="dark"] .option-btn {
      color: #f5f5f5;
    }

    [data-theme="dark"] .option-btn .option-text {
      color: #f5f5f5;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: var(--background);
      color: var(--text-primary);
      transition: all 0.3s ease;
    }

    .container {
      width: 100%;
      max-width: 700px;
      margin: 0 auto;
      padding: 20px 10px;
      box-sizing: border-box;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    h1, h2, h3 {
      color: var(--text-primary);
      text-align: center;
    }

    .theme-toggle {
      background: var(--button-bg);
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: absolute;
      top: -40px;
      right: 0;
      z-index: 1000;
    }

    .theme-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 2px 4px var(--shadow);
    }

    .theme-toggle i {
      font-size: 20px;
      color: var(--text-primary);
    }

    .back-link {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-primary);
      text-decoration: none;
      padding: 6px 12px;
      border-radius: 6px;
      background-color: var(--button-bg);
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .back-link:hover {
      background-color: var(--primary);
      color: white;
    }

    .back-link i {
      font-size: 18px;
    }

    .instructions-section {
      text-align: center;
      padding: 20px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      border: 1px solid var(--border);
      max-width: 600px;
      width: 90%;
      position: relative;
      margin-top: 20px;
    }

    .instructions-section .back-link {
      position: absolute;
      top: 10px;
      left: 10px;
    }

    .instructions-section h2 {
      margin-bottom: 20px;
      font-size: 24px;
      color: var(--primary);
    }

    .instructions-section p {
      margin-bottom: 20px;
      font-size: 16px;
      color: var(--text-primary);
    }

    .instructions-section ul {
      list-style-type: disc;
      padding-left: 20px;
      margin-bottom: 20px;
      text-align: left;
    }

    .instructions-section li {
      margin-bottom: 10px;
      font-size: 16px;
      color: var(--text-primary);
    }

    .instructions-section li::marker {
      color: var(--primary);
    }

    .start-btn {
      display: block;
      width: 100%;
      max-width: 280px;
      margin: 10px auto;
      padding: 12px 15px;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      position: relative;
    }

    .start-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px var(--shadow);
    }

    #quiz-container {
      width: 100%;
      max-width: 600px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-top: 20px;
    }

    #question-display {
      width: 100%;
      max-width: 600px;
    }

    .question-card {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 20px;
      background-color: var(--card-bg);
      width: 100%;
      max-width: 600px;
      box-sizing: border-box;
      margin: 0;
      display: flex;
      flex-direction: column;
    }

    .question-text {
      font-size: 1.1rem;
      line-height: 1.5;
      color: var(--text-primary);
      margin-bottom: 16px;
      padding: 12px;
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 2px 4px var(--shadow);
      min-height: 80px;
      height: auto;
      width: 100%;
      box-sizing: border-box;
      overflow-y: auto;
      white-space: normal;
      word-wrap: break-word;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 16px;
      width: 100%;
      max-width: 600px;
    }

    .option-btn {
      background: var(--button-bg);
      padding: 12px 16px;
      border-radius: 8px;
      border: 1px solid var(--border);
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      min-height: 50px;
      width: 100%;
      box-sizing: border-box;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .option-text {
      flex: 1;
      text-align: left;
      font-size: 0.9rem;
      white-space: normal;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
    }

    .option-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px var(--shadow);
      border-color: var(--primary);
    }

    .option-btn.selected {
      background: var(--gradient);
      color: white;
      transform: scale(1.02);
      box-shadow: 0 6px 12px var(--shadow);
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1.02); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1.02); }
    }

    .result {
      background: var(--card-bg);
      padding: 20px;
      margin-top: 20px;
      border-radius: 10px;
      border: 1px solid var(--border);
      overflow-y: auto;
      width: 100%;
      box-sizing: border-box;
    }

    .result-status {
      position: absolute;
      top: 0;
      right: 0;
      padding: 8px 16px;
      border-bottom-left-radius: 10px;
      font-weight: bold;
    }

    .correct-status {
      background-color: var(--correct-green);
      color: white;
    }

    .wrong-status {
      background-color: var(--error-light);
      color: var(--error);
    }

    .unanswered-status {
      background-color: var(--warning-light);
      color: var(--warning);
    }

    .result-content {
      margin-top: 10px;
      padding: 15px;
      border-radius: 8px;
      background-color: var(--card-bg);
      border: 1px solid var(--border);
    }

    .result[data-status="correct"] .result-content {
      background-color: var(--primary-bg);
      border-left: 4px solid var(--correct-green);
    }

    .result[data-status="incorrect"] .result-content {
      background-color: var(--error-bg);
      border-left: 4px solid var(--error);
    }

    .result[data-status="unanswered"] .result-content {
      background-color: var(--warning-bg);
      border-left: 4px solid var(--warning);
    }

    .answer-row {
      margin: 12px 0;
      padding: 10px;
      border-radius: 8px;
      background: var(--button-bg);
    }

    .answer-label {
      color: var(--text-secondary);
      margin-bottom: 6px;
      font-size: 0.9rem;
      font-weight: bold;
    }

    .answer-content {
      font-size: 0.9rem;
      line-height: 1.4;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid var(--border);
    }

    .explanation {
      margin-top: 12px;
      padding: 10px;
      border-radius: 6px;
      background-color: var(--info-light);
      border-left: 4px solid var(--info);
      font-size: 0.9rem;
    }

    #timer {
      font-size: 1rem;
      color: var(--primary);
      text-align: right;
      position: relative;
    }

    .debug-info {
      background-color: var(--button-bg);
      padding: 10px;
      border: 1px solid var(--border);
      margin: 15px 0;
      border-radius: 5px;
      display: none;
      font-size: 0.8rem;
    }

    .controls {
      margin: 10px 0;
      display: flex;
      justify-content: flex-end;
      width: 100%;
      padding: 0 5px;
      box-sizing: border-box;
      min-height: 60px;
      align-items: center;
    }

    .nav-button {
      padding: 10px 20px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      min-width: 80px;
      background-color: var(--primary);
      color: white;
    }

    .nav-button.next-btn {
      position: relative;
    }

    .nav-button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px var(--shadow);
    }

    .nav-button:disabled {
      background-color: var(--button-bg);
      color: var(--text-secondary);
      cursor: not-allowed;
      opacity: 0.6;
    }

    .progress-container {
      width: 100%;
      height: 6px;
      background-color: var(--button-bg);
      border-radius: 4px;
      margin: 15px 0;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background-color: var(--primary);
      width: 0%;
      transition: width 0.3s ease;
    }

    .quiz-header {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      position: relative;
    }

    #question-counter {
      text-align: left;
      flex: 1;
    }

    .results-container {
      display: none;
      width: 100%;
      max-width: 600px;
      position: relative;
      margin-top: 20px;
    }

    .results-summary {
      text-align: center;
      margin-bottom: 20px;
      padding: 20px;
      background: var(--card-bg);
      border-radius: 10px;
      border: 1px solid var(--border);
      position: relative;
    }

    .results-container .back-link {
      position: absolute;
      top: 10px;
      left: 10px;
      padding: 4px 8px;
      font-size: 0.8rem;
    }

    .results-container .back-link i {
      font-size: 14px;
    }

    .score-circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: conic-gradient(var(--primary) 0%, var(--primary) var(--percentage), var(--button-bg) var(--percentage), var(--button-bg) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 15px;
    }

    .score-inner {
      width: 100px;
      height: 100px;
      background-color: var(--card-bg);
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .score-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--text-primary);
    }

    .score-label {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    .time-taken {
      margin-top: 15px;
      padding: 8px;
      background-color: var(--info-light);
      border-radius: 5px;
      font-size: 0.9rem;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 15px;
    }

    .stat-card {
      background-color: var(--button-bg);
      padding: 12px;
      border-radius: 8px;
      text-align: center;
    }

    .stat-value {
      font-size: 1.2rem;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    .try-again-btn, .analysis-btn {
      padding: 10px 20px;
      background-color: var(--try-again);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9rem;
      margin: 10px 5px;
      transition: transform 0.2s;
      display: inline-block;
    }

    .try-again-btn:hover, .analysis-btn:hover {
      transform: translateY(-2px);
      opacity: 0.9;
    }

    .question-indicators {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 6px;
      max-width: 400px;
      margin: 15px auto;
      padding: 0 5px;
    }

    .question-dot {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      color: white;
      transition: transform 0.2s;
      flex: 0 0 28px;
    }

    .question-dot:hover {
      transform: scale(1.2);
    }

    .dot-correct {
      background-color: #4CAF50;
    }

    .dot-wrong {
      background-color: #f44336;
    }

    .dot-unanswered {
      background-color: #FF9800;
    }

    .loading-container {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 40px 0;
      text-align: center;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid var(--button-bg);
      border-top: 5px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-text {
      font-size: 18px;
      color: var(--text-primary);
      font-weight: bold;
    }

    .analysis-section {
      display: none;
      margin-top: 30px;
      width: 100%;
      max-width: 600px;
    }

    .topic-scores {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .topic-score-card {
      background-color: var(--card-bg);
      padding: 20px;
      border-radius: 8px;
      border: 1px solid var(--border);
      text-align: center;
      transition: transform 0.2s ease;
    }

    .topic-score-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px var(--shadow);
    }

    .topic-name {
      font-size: 18px;
      font-weight: bold;
      color: var(--text-primary);
      margin-bottom: 10px;
    }

    .topic-score {
      font-size: 24px;
      font-weight: bold;
      color: var(--primary);
    }

    .analysis-details {
      display: flex;
      flex-direction: column;
      gap: 15px;
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
    }

    .analysis-card {
      background-color: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 4px var(--shadow);
      transition: transform 0.2s ease;
    }

    .analysis-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px var(--shadow);
    }

    .analysis-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .question-number {
      font-size: 16px;
      font-weight: bold;
      color: var(--primary);
    }

    .status-correct,
    .status-incorrect,
    .status-unanswered {
      font-weight: bold;
      display: flex;
      align-items: center;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 14px;
    }

    .status-correct {
      color: var(--correct-green);
      background-color: var(--primary-bg);
    }

    .status-correct i {
      color: var(--correct-green);
      margin-right: 5px;
    }

    .status-incorrect {
      color: var(--error);
      background-color: var(--error-bg);
    }

    .status-incorrect i {
      color: var(--error);
      margin-right: 5px;
    }

    .status-unanswered {
      color: var(--warning);
      background-color: var(--warning-bg);
    }

    .status-unanswered i {
      color: var(--warning);
      margin-right: 5px;
    }

    .analysis-info {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 12px;
      background-color: var(--button-bg);
      border-radius: 6px;
      font-size: 14px;
    }

    .info-label {
      color: var(--text-secondary);
      font-weight: bold;
    }

    .info-value {
      color: var(--text-primary);
    }

    .no-results {
      text-align: center;
      padding: 20px;
      color: var(--text-secondary);
      font-size: 16px;
    }

    /* Media Queries for Responsiveness */
    @media (max-width: 768px) {
      .container {
        width: 100%;
        padding: 15px;
        justify-content: flex-start;
        padding-top: 60px;
      }

      .instructions-section {
        width: 95%;
        margin-top: 10px;
        padding: 15px;
      }

      .quiz-header {
        flex-direction: row;
        justify-content: space-between;
      }

      #timer {
        font-size: 0.9rem;
      }

      #quiz-container {
        width: 95%;
        margin-top: 10px;
      }

      #question-display {
        width: 100%;
        max-width: 100%;
      }

      .question-card {
        padding: 15px;
        min-height: auto;
        width: 100%;
        max-width: 100%;
      }

      .question-text {
        font-size: 1rem;
        min-height: 70px;
        width: 100%;
        max-width: 100%;
      }

      .options {
        width: 100%;
        max-width: 100%;
        padding: 0 5px;
      }

      .option-btn {
        padding: 10px 12px;
        min-height: 48px;
        font-size: 0.85rem;
        width: 100%;
        max-width: 100%;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .question-indicators {
        max-width: 300px;
        gap: 5px;
      }

      .question-dot {
        width: 24px;
        height: 24px;
        font-size: 10px;
        flex: 0 0 24px;
      }

      .controls {
        padding: 0;
        margin: 8px 0;
        flex-direction: row;
        gap: 10px;
        min-height: 50px;
      }

      .nav-button {
        padding: 8px 12px;
        font-size: 0.85rem;
        min-width: 70px;
      }

      .score-circle {
        width: 100px;
        height: 100px;
      }

      .score-inner {
        width: 80px;
        height: 80px;
      }

      .score-value {
        font-size: 1.2rem;
      }

      .score-label {
        font-size: 0.7rem;
      }

      .result {
        padding: 15px;
      }

      .theme-toggle {
        top: -36px;
        right: 0;
      }

      .analysis-section {
        margin-top: 20px;
      }

      .topic-scores {
        grid-template-columns: 1fr;
      }

      .analysis-card {
        padding: 15px;
      }

      .analysis-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .question-number {
        font-size: 14px;
      }

      .status-correct,
      .status-incorrect,
      .status-unanswered {
        font-size: 13px;
        padding: 4px 8px;
      }

      .info-row {
        font-size: 13px;
        padding: 6px 10px;
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 10px;
        padding-top: 50px;
      }

      .theme-toggle {
        width: 32px;
        height: 32px;
        top: -34px;
        right: 0;
      }

      .theme-toggle i {
        font-size: 18px;
      }

      .back-link {
        padding: 4px 8px;
        font-size: 0.75rem;
      }

      .back-link i {
        font-size: 12px;
      }

      .instructions-section h2 {
        font-size: 20px;
      }

      .instructions-section p,
      .instructions-section li {
        font-size: 14px;
      }

      .start-btn {
        padding: 10px 12px;
        font-size: 0.9rem;
      }

      .question-text {
        font-size: 0.9rem;
        min-height: 60px;
        width: 100%;
        max-width: 100%;
      }

      #question-display {
        width: 100%;
        max-width: 100%;
      }

      .question-card {
        width: 100%;
        max-width: 100%;
        padding: 10px;
      }

      .options {
        width: 100%;
        max-width: 100%;
        padding: 0 2px;
      }

      .option-btn {
        min-height: 45px;
        font-size: 0.8rem;
        width: 100%;
        max-width: 100%;
        padding: 8px 10px;
      }

      .nav-button {
        padding: 8px 10px;
        font-size: 0.8rem;
      }

      .answer-content {
        font-size: 0.8rem;
      }

      .explanation {
        font-size: 0.8rem;
      }

      .controls {
        margin: 8px 0;
        min-height: 48px;
      }

      .timer {
        font-size: 0.8rem;
      }

      #question-counter {
        font-size: 1.2rem;
      }

      .analysis-card {
        padding: 10px;
      }

      .question-number {
        font-size: 13px;
      }

      .status-correct,
      .status-incorrect,
      .status-unanswered {
        font-size: 12px;
        padding: 3px 6px;
      }

      .info-row {
        font-size: 12px;
        padding: 5px 8px;
      }
    }

    @media (max-width: 360px) {
      .container {
        padding: 8px;
        padding-top: 45px;
      }

      .question-text {
        font-size: 0.85rem;
        padding: 8px;
      }

      .options {
        gap: 8px;
      }

      .option-btn {
        padding: 6px 8px;
        font-size: 0.75rem;
        min-height: 40px;
      }

      .question-card {
        padding: 8px;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <div class="instructions-section" id="instructions-section">
    <a href="Topics.html#testarea" class="back-link" id="difficulty-back">
      <i class='bx bx-arrow-back'></i>
      Back
    </a>
    <h2>Mock Test</h2>
    <p>
      This contains the combined questions from all the above topics from Practice Area section. The questions are selected in a specific order from each topic to ensure a balanced assessment.
    </p>
    <ul>
      <li>There are <b>7</b> Topics and each Topic has <b>5</b> Subtopics.</li>
      <li>There will be <b>1</b> question from each Subtopic.</li>
      <li>There is no <b>Back</b> button in this test, so if you go to the next question you cannot go back.</li>
      <li>Total number of questions: <strong>35</strong>.</li>
      <li>Time allotted: <strong>45 minutes</strong>.</li>
      <li>Each question carries 1 mark; there are <strong>no negative marks</strong>.</li>
      <li><strong>DO NOT</strong> refresh the page.</li>
      <li>All the best!</li>
    </ul>
    <button class="start-btn" onclick="startTest()">Start Test</button>
  </div>

  <div class="loading-container" id="loading-container">
    <div class="spinner"></div>
    <div class="loading-text">Loading Questions...</div>
  </div>

  <div class="debug-info" id="debug-info"></div>

  <div id="quiz-container" style="display: none;">
    <div class="quiz-header">
      <h2 id="question-counter">Question 1</h2>
      <div id="timer">Time left: <span id="time">45:00</span>
        <button class="theme-toggle" id="theme-toggle" title="Toggle Theme">
          <i class='bx bx-moon'></i>
        </button>
      </div>
    </div>
    <div class="progress-container">
      <div class="progress-bar" id="progress-bar"></div>
    </div>
    <div id="question-display"></div>
    <div class="controls" id="nav-buttons" style="display: none;">
      <button id="next-btn" class="nav-button next-btn" disabled>Next</button>
    </div>
  </div>

  <div id="results-container" class="results-container">
    <div class="results-summary" id="results-summary"></div>
    <div class="question-indicators" id="question-indicators"></div>
    <div id="detailed-results"></div>
    <div class="analysis-section" id="analysis-section">
      <h2>Detailed Performance Analysis</h2>
      <div class="topic-scores" id="topic-scores"></div>
      <div class="analysis-details" id="analysis-details"></div>
    </div>
    <div style="text-align: center; margin-top: 20px;">
      <button id="try-again-btn" class="try-again-btn">Try Again</button>
      <button id="analysis-btn" class="analysis-btn">View Detailed Analysis</button>
    </div>
  </div>
</div>

<script>
// Supabase configuration
const supabaseUrl = 'https://zfmakkkhbgizrtpmzjmh.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpmbWFra2toYmdpenJ0cG16am1oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY3MTg4OTUsImV4cCI6MjA2MjI5NDg5NX0.Q-uoMbcws92SHrT28i930w5iL-DBf1x30Kl0SpFtxhk';
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

// Global state
let questions = [];
let userAnswers = {};
let timerSeconds = 2700; // 45 minutes
let timeTaken = 0;
let timerInterval;
let currentQuestionIndex = 0;
let startTime;
const questionCount = 35;
let questionTimes = new Array(questionCount).fill(0);
let currentDifficulty = 'easy';

// Theme toggle functionality
const themeToggle = document.getElementById('theme-toggle');
const themeIcon = themeToggle.querySelector('i');

function setTheme(theme) {
  document.documentElement.setAttribute('data-theme', theme);
  themeIcon.classList.toggle('bx-moon', theme === 'dark');
  themeIcon.classList.toggle('bx-sun', theme === 'light');
  localStorage.setItem('theme', theme);
}

function toggleTheme() {
  const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
  setTheme(newTheme);
}

const savedTheme = localStorage.getItem('theme') || 'dark';
setTheme(savedTheme);

themeToggle.addEventListener('click', toggleTheme);

// Debug toggle
function toggleDebug() {
  const debugEl = document.getElementById('debug-info');
  debugEl.style.display = debugEl.style.display === 'none' ? 'block' : 'none';
}

// Start the test
function startTest() {
  const urlParams = new URLSearchParams(window.location.search);
  currentDifficulty = urlParams.get('difficulty') || 'easy';
  
  document.getElementById('instructions-section').style.display = 'none';
  document.getElementById('loading-container').style.display = 'flex';
  document.getElementById('quiz-container').style.display = 'none';
  document.getElementById('nav-buttons').style.display = 'none';
  document.getElementById('difficulty-back').style.display = 'none';
  resetQuiz();
}

// Reset quiz state
function resetQuiz() {
  clearInterval(timerInterval);
  questions = [];
  userAnswers = {};
  questionTimes = new Array(questionCount).fill(0);
  timerSeconds = 2700;
  timeTaken = 0;
  currentQuestionIndex = 0;
  
  document.getElementById('time').textContent = formatTime(timerSeconds);
  document.getElementById('question-display').innerHTML = '';
  document.getElementById('detailed-results').innerHTML = '';
  document.getElementById('results-summary').innerHTML = '';
  document.getElementById('question-indicators').innerHTML = '';
  document.getElementById('analysis-section').style.display = 'none';
  document.getElementById('results-container').style.display = 'none';
  document.getElementById('quiz-container').style.display = 'flex';
  document.getElementById('nav-buttons').style.display = 'flex';
  
  document.getElementById('difficulty-back').style.display = 'none';
  
  updateProgressBar();
  fetchQuestions();
}

// Start timer
function startTimer() {
  startTime = new Date();
  document.getElementById('time').textContent = formatTime(timerSeconds);
  timerInterval = setInterval(() => {
    timerSeconds--;
    document.getElementById('time').textContent = formatTime(timerSeconds);
    
    const timerElement = document.getElementById('timer');
    if (timerSeconds <= 60) {
      timerElement.style.color = 'var(--error)';
    } else if (timerSeconds <= 180) {
      timerElement.style.color = 'var(--warning)';
    } else {
      timerElement.style.color = 'var(--primary)';
    }
    
    if (timerSeconds <= 0) {
      clearInterval(timerInterval);
      submitQuiz();
    }
  }, 1000);
}

// Calculate total time taken
function calculateTimeTaken() {
  const endTime = new Date();
  timeTaken = Math.floor((endTime - startTime) / 1000);
  return timeTaken;
}

// Format time as MM:SS
function formatTime(seconds) {
  const minutes = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

// Utility function to get a random item from an array
function getRandomItem(array) {
  if (!array || array.length === 0) return null;
  const randomIndex = Math.floor(Math.random() * array.length);
  return array[randomIndex];
}

// Fetch questions from Supabase with randomization
async function fetchQuestions() {
  try {
    const questionStructure = [
      {
        topic: "General Aptitude",
        subtopics: [
          "Logical Reasoning",
          "Ratio & Proportion",
          "Averages, Profit & Loss",
          "HCF & LCM, Simplification",
          "Probability, Permutations & Combinations"
        ]
      },
      {
        topic: "Arithmetic Aptitude",
        subtopics: [
          "Percentages",
          "Time & Work",
          "Time, Speed & Distance",
          "Measurements & Geometry",
          "Simple & Compound Interest"
        ]
      },
      {
        topic: "Technical MCQs",
        subtopics: [
          "Operating Systems",
          "Computer Networks",
          "Computer Architecture",
          "Database Management",
          "Data Structures & Algorithms"
        ]
      },
      {
        topic: "Programming Languages",
        subtopics: [
          "Java",
          "Python",
          "C & C++",
          "JavaScript",
          "Modern Languages"
        ]
      },
      {
        topic: "BrainRot Topics",
        subtopics: [
          "Blood Relations",
          "Direction Problems",
          "Coding and Decoding",
          "Seating Arrangements",
          "Train, Boat, Tank and Pipe Problems"
        ]
      },
      {
        topic: "Verbal and Reasoning",
        subtopics: [
          "Verbal Ability",
          "English Grammar",
          "Verbal Reasoning",
          "Non Verbal Reasoning",
          "Antonyms & Synonyms, Fill in the blanks"
        ]
      },
      {
        topic: "Extra Concepts",
        subtopics: [
          "Cloud Computing",
          "Artificial Intelligence",
          "Software Engineering",
          "Situational Questions",
          "Web Content Management"
        ]
      }
    ];

    let tableName;
    switch (currentDifficulty.toLowerCase()) {
      case 'easy':
        tableName = 'general_aptitude';
        break;
      case 'medium':
        tableName = 'general_aptitude_medium';
        break;
      case 'hard':
        tableName = 'general_aptitude_hard';
        break;
      default:
        tableName = 'general_aptitude';
    }

    questions = [];
    let debugInfo = [];

    for (const { topic, subtopics } of questionStructure) {
      for (const subtopic of subtopics) {
        // Fetch all questions for the topic and subtopic
        const { data, error } = await supabase
          .from(tableName)
          .select('*')
          .eq('topic', topic)
          .eq('subtopic', subtopic);

        if (error) {
          debugInfo.push(`Error fetching questions for ${topic} - ${subtopic}: ${error.message}`);
          console.error(`Error: ${error.message}`);
          continue;
        }

        if (!data || data.length === 0) {
          debugInfo.push(`No questions found for ${topic} - ${subtopic}`);
          continue;
        }

        // Randomly select one question from the available questions
        const selectedQuestion = getRandomItem(data);
        questions.push(selectedQuestion);
        debugInfo.push(`Selected question ID ${selectedQuestion.id} for ${topic} - ${subtopic} (${data.length} available)`);
      }
    }

    if (questions.length !== questionCount) {
      throw new Error(
        `Expected ${questionCount} questions, but got ${questions.length}. Check database for missing questions in ${tableName}.`
      );
    }

    const debugEl = document.getElementById('debug-info');
    debugEl.innerHTML = `
      <strong>Debug Info:</strong><br>
      Total questions selected: ${questions.length}<br>
      Table used: ${tableName}<br>
      ${debugInfo.join('<br>')}
    `;

    updateProgressBar();
    startTimer();
    showQuestion(0);
  } catch (err) {
    console.error('Error:', err);
    document.getElementById('question-display').innerHTML = `
      <div style="color: var(--error); padding: 20px; border: 1px solid var(--error); border-radius: 5px;">
        Error loading quiz: ${err.message}<br>
        Please check your database connection and table structure.
      </div>`;
    document.getElementById('loading-container').style.display = 'none';
  }
}

// Get option column names from database
function getOptionColumnNames(question) {
  if (!question) return null;

  // Possible column names for options
  const possibleOptionKeys = [
    'option1', 'option_1', 'option_a', 'optionA', 'a', 'A',
    'option2', 'option_2', 'option_b', 'optionB', 'b', 'B',
    'option3', 'option_3', 'option_c', 'optionC', 'c', 'C',
    'option4', 'option_4', 'option_d', 'optionD', 'd', 'D'
  ];

  const optionColumns = {
    option1: null,
    option2: null,
    option3: null,
    option4: null
  };

  // Check which option columns exist in the question object
  const questionKeys = Object.keys(question);
  let foundOptions = 0;

  for (let i = 1; i <= 4; i++) {
    for (const key of possibleOptionKeys) {
      if (questionKeys.includes(key) && question[key] && !optionColumns[`option${i}`]) {
        if (key.toLowerCase().includes(`${i}`) || key.toLowerCase() === ['a', 'b', 'c', 'd'][i-1]) {
          optionColumns[`option${i}`] = key;
          foundOptions++;
          break;
        }
      }
    }
  }

  if (foundOptions < 4) {
    console.error(`Incomplete option columns found: ${JSON.stringify(optionColumns)}`);
    return null;
  }

  return optionColumns;
}

// Get correct answer column name
function getCorrectAnswerColumn(question) {
  if (!question) return null;
  
  const possibleCorrectKeys = [
    'correct_option', 'correct_answer', 'correctOption', 'correctAnswer',
    'answer', 'correct'
  ];

  return possibleCorrectKeys.find(key => question[key] !== undefined) || null;
}

// Get explanation column name
function getExplanationColumn(question) {
  if (!question) return null;
  
  const possibleExplanationKeys = ['explanation', 'feedback'];
  return possibleExplanationKeys.find(key => question[key] !== undefined) || null;
}

// Update progress bar and question counter
function updateProgressBar() {
  const progress = (currentQuestionIndex / questions.length) * 100;
  document.getElementById('progress-bar').style.width = `${progress}%`;
  document.getElementById('question-counter').textContent = `Question ${currentQuestionIndex + 1}/${questions.length}`;
  
  document.getElementById('next-btn').textContent = currentQuestionIndex === questions.length - 1 ? 'Finish Quiz' : 'Next';
}

// Display a question
function showQuestion(index) {
  if (index < 0 || index >= questions.length) return;
  
  currentQuestionIndex = index;
  updateProgressBar();
  
  const q = questions[index];
  const containerElement = document.getElementById('question-display');
  containerElement.innerHTML = '';
  
  window.questionStartTime = new Date();
  
  const optionCols = getOptionColumnNames(q);
  if (!optionCols || !optionCols.option1) {
    containerElement.innerHTML = `
      <div style="color: var(--error); padding: 20px; border: 1px solid var(--error); border-radius: 5px;">
        Cannot find option columns in database for question ID ${q.id || 'unknown'}. Please check column names (expected: option1-4, option_a-d, etc.).
        <br>Available columns: ${Object.keys(q).join(', ')}
      </div>`;
    document.getElementById('loading-container').style.display = 'none';
    return;
  }
  
  const questionDiv = document.createElement('div');
  questionDiv.className = 'question-card';
  questionDiv.innerHTML = `
    <div class="question-text">
      ${q.question || 'Question text missing'}
    </div>
    <div class="options">
      <button onclick="selectOption(${index}, 1, this)" class="option-btn ${userAnswers[index] === 1 ? 'selected' : ''}">
        <span class="option-text">${q[optionCols.option1] || 'Option 1 missing'}</span>
      </button>
      <button onclick="selectOption(${index}, 2, this)" class="option-btn ${userAnswers[index] === 2 ? 'selected' : ''}">
        <span class="option-text">${q[optionCols.option2] || 'Option 2 missing'}</span>
      </button>
      <button onclick="selectOption(${index}, 3, this)" class="option-btn ${userAnswers[index] === 3 ? 'selected' : ''}">
        <span class="option-text">${q[optionCols.option3] || 'Option 3 missing'}</span>
      </button>
      <button onclick="selectOption(${index}, 4, this)" class="option-btn ${userAnswers[index] === 4 ? 'selected' : ''}">
        <span class="option-text">${q[optionCols.option4] || 'Option 4 missing'}</span>
      </button>
    </div>
  `;
  containerElement.appendChild(questionDiv);
  
  document.getElementById('loading-container').style.display = 'none';
  document.getElementById('quiz-container').style.display = 'flex';
  document.getElementById('nav-buttons').style.display = 'flex';

  const nextBtn = document.getElementById('next-btn');
  nextBtn.disabled = !userAnswers[index];
}

// Navigate to next question
function nextQuestion() {
  const endTime = new Date();
  const timeSpent = Math.floor((endTime - (window.questionStartTime || startTime)) / 1000);
  questionTimes[currentQuestionIndex] = timeSpent;

  if (currentQuestionIndex < questions.length - 1) {
    showQuestion(currentQuestionIndex + 1);
  } else {
    submitQuiz();
  }
}

// Select an option
function selectOption(qIndex, optionNum, btnElement) {
  if (userAnswers[qIndex] === optionNum) {
    delete userAnswers[qIndex];
    btnElement.classList.remove('selected');
  } else {
    userAnswers[qIndex] = optionNum;
    const buttons = btnElement.parentElement.querySelectorAll('button');
    buttons.forEach(btn => btn.classList.remove('selected'));
    btnElement.classList.add('selected');
  }

  const nextBtn = document.getElementById('next-btn');
  nextBtn.disabled = !userAnswers[qIndex];
}

// Show specific result question
function showResultQuestion(index) {
  const resultElements = document.querySelectorAll('.result');
  resultElements.forEach(el => el.style.display = 'none');
  resultElements[index].style.display = 'block';
}

// Load analysis section
function loadAnalysis() {
  let quizResults = [];
  try {
    const storedResults = localStorage.getItem('quizResults');
    if (storedResults) {
      quizResults = JSON.parse(storedResults);
    }
  } catch (e) {
    console.error('Error parsing quiz results:', e);
  }

  const topics = [
    "General Aptitude",
    "Arithmetic Aptitude",
    "Technical MCQs",
    "Programming Languages",
    "BrainRot Topics",
    "Verbal and Reasoning",
    "Extra Concepts"
  ];

  const topicScoresDiv = document.getElementById('topic-scores');
  topicScoresDiv.innerHTML = '';

  const analysisDetailsDiv = document.getElementById('analysis-details');
  analysisDetailsDiv.innerHTML = '';

  if (!Array.isArray(quizResults) || quizResults.length === 0) {
    topicScoresDiv.innerHTML = '<div class="no-results">No quiz results available</div>';
    analysisDetailsDiv.innerHTML = '<div class="no-results">No quiz results available</div>';
    return;
  }

  // Populate topic scores
  topics.forEach(topic => {
    const topicResults = quizResults.filter(result => result.topic === topic);
    const correctCount = topicResults.filter(result => result.status === 'Correct').length;
    const scoreCard = document.createElement('div');
    scoreCard.className = 'topic-score-card';
    scoreCard.innerHTML = `
      <div class="topic-name">${topic}</div>
      <div class="topic-score">${correctCount}/${topicResults.length}</div>
    `;
    topicScoresDiv.appendChild(scoreCard);
  });

  // Populate detailed analysis with cards
  quizResults.forEach(result => {
    const status = result.status || 'Unanswered';
    let statusClass, statusIcon;

    if (status === 'Correct') {
      statusClass = 'correct';
      statusIcon = '<i class="bx bx-check-circle"></i>';
    } else if (status === 'Incorrect') {
      statusClass = 'incorrect';
      statusIcon = '<i class="bx bx-x-circle"></i>';
    } else {
      statusClass = 'unanswered';
      statusIcon = '<i class="bx bx-help-circle"></i>';
    }

    const card = document.createElement('div');
    card.className = 'analysis-card';
    card.innerHTML = `
      <div class="analysis-header">
        <div class="question-number">Question ${result.questionNumber || 'N/A'}</div>
        <div class="status-${statusClass}">${statusIcon}${status}</div>
      </div>
      <div class="analysis-info">
        <div class="info-row">
          <span class="info-label">Topic:</span>
          <span class="info-value">${result.topic || 'N/A'}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Subtopic:</span>
          <span class="info-value">${result.subtopic || 'N/A'}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Time Taken:</span>
          <span class="info-value">${formatTime(result.timeTaken || 0)}</span>
        </div>
      </div>
    `;
    analysisDetailsDiv.appendChild(card);
  });
}

// Submit quiz and show results
function submitQuiz() {
  clearInterval(timerInterval);
  
  const endTime = new Date();
  const timeSpent = Math.floor((endTime - (window.questionStartTime || startTime)) / 1000);
  questionTimes[currentQuestionIndex] = timeSpent;
  
  calculateTimeTaken();
  
  document.getElementById('quiz-container').style.display = 'none';
  document.getElementById('nav-buttons').style.display = 'none';
  document.getElementById('results-container').style.display = 'block';
  document.getElementById('analysis-section').style.display = 'none';
  
  document.getElementById('difficulty-back').style.display = 'flex';
  
  const resultsDiv = document.getElementById('detailed-results');
  resultsDiv.innerHTML = '';
  
  let correctCount = 0;
  let wrongCount = 0;
  let unansweredCount = 0;
  const indicatorsDiv = document.getElementById('question-indicators');
  indicatorsDiv.innerHTML = '';
  
  const quizResults = questions.map((q, index) => {
    const userAnswer = userAnswers[index] || null;
    const optionCols = getOptionColumnNames(q);
    const correctCol = getCorrectAnswerColumn(q);
    
    if (!optionCols || !correctCol) {
      console.error(`Invalid columns for question ${index + 1}:`, { optionCols, correctCol });
      return {
        questionNumber: index + 1,
        topic: q.topic || 'Unknown',
        subtopic: q.subtopic || 'Unknown',
        status: 'Unanswered',
        timeTaken: questionTimes[index] || 0
      };
    }
    
    let correct;
    const correctVal = q[correctCol];
    if (typeof correctVal === 'number') {
      correct = correctVal;
    } else if (typeof correctVal === 'string') {
      const letterMap = { 'A': 1, 'B': 2, 'C': 3, 'D': 4, 'a': 1, 'b': 2, 'c': 3, 'd': 4 };
      correct = letterMap[correctVal] || parseInt(correctVal, 10) || 1;
    } else {
      correct = 1; // Fallback to avoid undefined
    }
    
    let resultStatus;
    if (userAnswer === null) {
      resultStatus = 'Unanswered';
      unansweredCount++;
    } else if (userAnswer === correct) {
      resultStatus = 'Correct';
      correctCount++;
    } else {
      resultStatus = 'Incorrect';
      wrongCount++;
    }
    
    return {
      questionNumber: index + 1,
      topic: q.topic || 'Unknown',
      subtopic: q.subtopic || 'Unknown',
      status: resultStatus,
      timeTaken: questionTimes[index] || 0
    };
  });
  
  localStorage.setItem('quizResults', JSON.stringify(quizResults));
  
  questions.forEach((q, index) => {
    const userAnswer = userAnswers[index] || null;
    const optionCols = getOptionColumnNames(q);
    const correctCol = getCorrectAnswerColumn(q);
    const explanationCol = getExplanationColumn(q);
    
    if (!optionCols || !correctCol) {
      resultsDiv.innerHTML += `
        <div class="result" data-status="unanswered">
          <div class="result-status unanswered-status">Unanswered</div>
          <div class="result-content">
            <div class="result-question">Q${index + 1}: ${q.question || 'Question missing'}</div>
            <div class="answer-row">
              <div class="answer-label">Error:</div>
              <div class="answer-content">Invalid option or correct answer columns in database.</div>
            </div>
          </div>
        </div>`;
      return;
    }
    
    let correct;
    const correctVal = q[correctCol];
    if (typeof correctVal === 'number') {
      correct = correctVal;
    } else if (typeof correctVal === 'string') {
      const letterMap = { 'A': 1, 'B': 2, 'C': 3, 'D': 4, 'a': 1, 'b': 2, 'c': 3, 'd': 4 };
      correct = letterMap[correctVal] || parseInt(correctVal, 10) || 1;
    } else {
      correct = 1; // Fallback to avoid undefined
    }
    
    let resultStatus, resultClass;
    
    if (userAnswer === null) {
      resultStatus = 'Unanswered';
      resultClass = 'unanswered-status';
    } else if (userAnswer === correct) {
      resultStatus = 'Correct';
      resultClass = 'correct-status';
    } else {
      resultStatus = 'Incorrect';
      resultClass = 'wrong-status';
    }
    
    const userOptionText = userAnswer ? q[optionCols[`option${userAnswer}`]] || 'Option missing' : 'Not answered';
    const correctOptionText = q[optionCols[`option${correct}`]] || 'Option missing';
    const userAnswerLetter = userAnswer ? ['A', 'B', 'C', 'D'][userAnswer - 1] : '';
    const correctLetter = ['A', 'B', 'C', 'D'][correct - 1];
    
    const explanationText = explanationCol && q[explanationCol] ? 
      `<div class="explanation">${q[explanationCol]}</div>` : '';
    
    const resultDiv = document.createElement('div');
    resultDiv.className = 'result';
    resultDiv.style.display = index === 0 ? 'block' : 'none';
    resultDiv.setAttribute('data-status', resultStatus.toLowerCase());
    resultDiv.innerHTML = `
      <div class="result-status ${resultClass}">${resultStatus}</div>
      <div class="result-content">
        <div class="result-question">Q${index + 1}: ${q.question || 'Question missing'}</div>
        
        <div class="answer-row">
          <div class="answer-label">Your answer:</div>
          <div class="answer-content">${userAnswer ? `${userAnswerLetter}. ${userOptionText}` : '<span style="color:var(--warning)">Not answered</span>'}</div>
        </div>
        
        ${userAnswer !== correct || !userAnswer ? `
        <div class="answer-row">
          <div class="answer-label">Correct answer:</div>
          <div class="answer-content">${correctLetter}. ${correctOptionText}</div>
        </div>
        ` : ''}
        
        ${explanationText}
      </div>
    `;
    resultsDiv.appendChild(resultDiv);
    
    const dotClass = userAnswer === null ? 'dot-unanswered' : 
                     userAnswer === correct ? 'dot-correct' : 'dot-wrong';
    const dotElement = document.createElement('div');
    dotElement.className = `question-dot ${dotClass}`;
    dotElement.setAttribute('onclick', `showResultQuestion(${index})`);
    dotElement.setAttribute('title', `Question ${index + 1}`);
    dotElement.textContent = `${index + 1}`;
    indicatorsDiv.appendChild(dotElement);
  });
  
  const scorePercentage = Math.round((correctCount / questions.length) * 100);
  
  const summaryDiv = document.getElementById('results-summary');
  summaryDiv.innerHTML = `
    <a href="Topics.html#testarea" class="back-link">
      <i class='bx bx-arrow-back'></i>
      Back
    </a>
    <h2>General Aptitude Test Results</h2>
    
    <div class="score-circle" style="--percentage: ${scorePercentage}%;">
      <div class="score-inner">
        <div class="score-value">${correctCount}/${questions.length}</div>
        <div class="score-label">${scorePercentage}%</div>
      </div>
    </div>
    
    <div class="time-taken">
      <i class="time-icon"></i> Time taken: ${formatTime(timeTaken)}
    </div>
    
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" style="color: var(--correct-green);">${correctCount}</div>
        <div class="stat-label">Correct</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" style="color: var(--error);">${wrongCount}</div>
        <div class="stat-label">Incorrect</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" style="color: var(--warning);">${unansweredCount}</div>
        <div class="stat-label">Unanswered</div>
      </div>
    </div>
  `;
  
  document.getElementById('progress-bar').style.width = '100%';
  
  loadAnalysis();
}

// Event listeners
document.getElementById('next-btn').addEventListener('click', nextQuestion);

document.getElementById('try-again-btn').addEventListener('click', () => {
  window.location.href = `Mock Test Main.html?difficulty=${currentDifficulty}`;
});

document.getElementById('analysis-btn').addEventListener('click', () => {
  const analysisSection = document.getElementById('analysis-section');
  const isVisible = analysisSection.style.display === 'block';
  analysisSection.style.display = isVisible ? 'none' : 'block';
  document.getElementById('analysis-btn').textContent = isVisible ? 'View Detailed Analysis' : 'Hide Detailed Analysis';
});
</script>
</body>
</html>